VPATH=./src/:./examples
EXEC=tinydarknet
OBJDIR=./obj/

CC=arm-none-eabi-gcc
OPTS=-O2
#OPTS=-O0 -g
LDFLAGS= -lm
COMMON= -Iinclude/ -Isrc/
CFLAGS=--specs=nosys.specs -Wall -Wno-unused-result -Wno-unknown-pragmas -Wfatal-errors -fPIC -mlittle-endian -mthumb -mcpu=cortex-m4 -mthumb-interwork -mfloat-abi=hard -mfpu=fpv4-sp-d16

CFLAGS+=$(OPTS)


OBJ=gemm.o utils.o list.o blas.o parser.o option_list.o network.o dropout_layer.o softmax_layer.o connected_layer.o cost_layer.o activation_layer.o

EXECOBJA=classifier.o darknet.o


EXECOBJ = $(addprefix $(OBJDIR), $(EXECOBJA))
OBJS = $(addprefix $(OBJDIR), $(OBJ))
DEPS = $(wildcard src/*.h) Makefile include/darknet.h

all: obj $(EXEC)

$(EXEC): $(EXECOBJ) $(OBJS)
	$(CC) $(COMMON) $(CFLAGS) $^ -o $@ $(LDFLAGS)

$(OBJDIR)%.o: %.c $(DEPS)
	$(CC) $(COMMON) $(CFLAGS) -c $< -o $@

obj:
	mkdir -p obj

.PHONY: clean

clean:
	rm -rf $(OBJS) $(EXEC) $(EXECOBJ) $(OBJDIR)/*